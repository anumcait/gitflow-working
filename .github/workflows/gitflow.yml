name: GitFlow Full Demo Pipeline

on:
  push:
    branches:
      - "**"           # run for all branches so nothing is skipped
  pull_request:
    branches:
      - "**"

jobs:

  # ----------------------------------
  # 1) TEST
  # ----------------------------------
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run unit tests
        run: echo "Running tests..."

  # ----------------------------------
  # 2) BUILD
  # ----------------------------------
  build:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build application
        run: echo "Building application..."

  # ----------------------------------
  # 3) INTEGRATE TO DEVELOP
  # ----------------------------------
  integrate_dev:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Merge code to develop (demo)
        run: |
          echo "Pretending to merge into develop branch..."
          echo "This is only a demo â€“ actual merge is not performed."

  # ----------------------------------
  # 4) RELEASE BUILD
  # ----------------------------------
  release:
    runs-on: ubuntu-latest
    needs: integrate_dev
    steps:
      - name: Create release bundle
        run: echo "Preparing release build..."

  # ----------------------------------
  # 5) PRE-PROD DEPLOY
  # ----------------------------------
  preprod:
    runs-on: ubuntu-latest
    needs: release
    steps:
      - name: Deploying to pre-production
        run: echo "Deploying to PREPROD environment..."

  # ----------------------------------
  # 6) PRE-PROD APPROVAL STEP
  # ----------------------------------
  hold:
    runs-on: ubuntu-latest
    needs: preprod
    steps:
      - name: Approval waiting simulation
        run: |
          echo "Pretending to wait for approval..."
          sleep 10
          echo "Approval granted!"

  # ----------------------------------
  # 7) PRODUCTION DEPLOY
  # ----------------------------------
  production:
    runs-on: ubuntu-latest
    needs: hold
    steps:
      - name: Deploying to PRODUCTION
        run: echo "Deploying to PRODUCTION environment..."

  # ----------------------------------
  # 8) HOTFIX PIPELINE
  # ----------------------------------
  hotfix:
    runs-on: ubuntu-latest
    needs: production
    steps:
      - name: Hotfix simulation
        run: echo "Running hotfix pipeline..."
